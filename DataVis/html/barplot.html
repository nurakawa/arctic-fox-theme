<!DOCTYPE html>
    <style>
    .legendOrdinal{
           font-family: sans-serif;
            font-size: 0.7em;
            margin: 0;
            display: block;
            background-color:white;
            }
        

    </style>

    <!-- Underneath: barplot -->
    <select id="indicator">
      <option value="new_cases_per_million">new cases per million</option>
      <option value="new_deaths_per_million">new deaths per million</option>
    </select>

    <div id="Exports" style="width: 100%; height: 300px;"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>

    <script src="../js/d3.barchart.js"></script>
    
        <script>
            d3.select("#indicator").on("change", function(d){
              selectedInd = String(this.value);
              d3.select("#Exports").selectAll("*").remove();
              //d3.select('#Exports .grafico').remove();
              updateBar(selectedInd)
            })
            
        function locPicker(v) {
        if (v == "cases_per_million") {
        return "location_cases";}
        else {
        return "location_deaths";}
        }
        
        updateBar('new_cases_per_million')
            
        function updateBar(selectedInd){

        d3.csv('../data/owid-data-barchart.csv', function(data) {
          
          //var newdata = data.filter(function(d){ return d.location == selectedCountry });
         var grafico = new BarChart(d3.select('#Exports'), data, {
                'key': selectedInd || 0,
                'label': 'date',
                'label2': locPicker(selectedInd),
                'mean': {},
                'meanlabel': '',
                'color': 'darkgrey',
                'title': 'Weekly ' + selectedInd,
                'source': '',
            });
            
          var ordinal = d3.scaleOrdinal(d3.schemeTableau10)
          .domain(["Asia", "Europe", "North America", "South America", "Africa"])
          
          var svg = d3.select("svg");
          
          svg.append("g")
          .attr("class", "legendOrdinal")
          .attr("transform", "translate(50,83)");
          
          var legendOrdinal = d3.legendColor()
          .shape("path", d3.symbol().type(d3.symbolSquare).size(30)())
          .shapePadding(3)
          //use cellFilter to hide the "e" cell
          .cellFilter(function(d){ return d.label !== "e" })
          .scale(ordinal);
          
          svg.select(".legendOrdinal")
          .call(legendOrdinal);
          
        
         
        });
        };

    </script> 
